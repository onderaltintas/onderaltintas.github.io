<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Sprite Tank Savaşı</title>
<style>
  body { margin:0; background:#ccc; display:flex; justify-content:center; align-items:center; height:100vh; }
  canvas { background:#ddd; display:block; }
</style>
</head>
<body>
<canvas id="gameCanvas" width="1280" height="1280"></canvas>
<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

const spriteSheet = new Image();
spriteSheet.src = "sprites.png"; // 6144x1024 PNG

const tanks = [];
const spriteVariants = [];

class Tank {
  constructor(x, y) {
    this.x = x;
    this.y = y;
    this.dirX = Math.random() < 0.5 ? -1 : 1;
    this.dirY = Math.random() < 0.5 ? -1 : 1;
    this.speed = 1.5;
    this.frame = 0;
    this.frameTick = 0;
    this.fireCooldown = 0;
    this.variant = Math.floor(Math.random() * spriteVariants.length);
  }

  getDirectionIndex(dx, dy) {
    if (dx === -1 && dy === 0) return 0; // Batı
    if (dx === -1 && dy === -1) return 1; // Kuzeybatı
    if (dx === 0 && dy === -1) return 2; // Kuzey
    if (dx === 1 && dy === -1) return 3; // Kuzeydoğu
    if (dx === 1 && dy === 0) return 4; // Doğu
    if (dx === 1 && dy === 1) return 5; // Güneydoğu
    if (dx === 0 && dy === 1) return 6; // Güney
    if (dx === -1 && dy === 1) return 7; // Güneybatı
    return 6;
  }

  update() {
    this.x += this.dirX * this.speed;
    this.y += this.dirY * this.speed;

    if (this.x < 0 || this.x > canvas.width) this.dirX *= -1;
    if (this.y < 0 || this.y > canvas.height) this.dirY *= -1;

    this.frameTick++;
    if (this.frameTick > 10) {
      this.frame = (this.frame + 1) % 8;
      this.frameTick = 0;
    }

    if (this.fireCooldown > 0) this.fireCooldown--;

    if (this.fireCooldown === 0) {
      const target = this.findTarget();
      if (target) {
        this.shoot(target);
        this.fireCooldown = 120;
      }
    }
  }

  findTarget() {
    for (let t of tanks) {
      if (t !== this) {
        const dx = t.x - this.x;
        const dy = t.y - this.y;
        if (Math.sign(dx) === this.dirX && Math.sign(dy) === this.dirY) {
          if (Math.abs(dx) < 80 && Math.abs(dy) < 80) return t;
        }
      }
    }
    return null;
  }

  shoot(target) {
    // anlık ateş çizgisi
    ctx.beginPath();
    ctx.moveTo(this.x, this.y);
    ctx.lineTo(target.x, target.y);
    ctx.strokeStyle = "red";
    ctx.lineWidth = 2;
    ctx.stroke();

    // hedefi sil
    const idx = tanks.indexOf(target);
    if (idx > -1) tanks.splice(idx, 1);
  }

  draw(ctx) {
    const spriteWidth = 128;
    const spriteHeight = 128;
    const startFrame = 12;
    const frame = startFrame + this.frame;
    const dir = this.getDirectionIndex(this.dirX, this.dirY);

    ctx.drawImage(
      spriteVariants[this.variant],
      frame * spriteWidth, dir * spriteHeight, spriteWidth, spriteHeight,
      this.x - 24, this.y - 24, 128, 128
    );
  }
}

function loop() {
  ctx.fillStyle = "#ddd";
  ctx.fillRect(0, 0, canvas.width, canvas.height);

  for (let t of tanks) t.update();
  for (let t of tanks) t.draw(ctx);

  requestAnimationFrame(loop);
}

spriteSheet.onload = () => {
  // 8 hue varyantı hazırla
  for (let i = 0; i < 8; i++) {
    const off = document.createElement("canvas");
    off.width = spriteSheet.width;
    off.height = spriteSheet.height;
    const offCtx = off.getContext("2d");
    offCtx.filter = `hue-rotate(${i * 45}deg)`;
    offCtx.drawImage(spriteSheet, 0, 0);
    offCtx.filter = "none";
    spriteVariants.push(off);
  }

  // tankları oluştur
  for (let i = 0; i < 5500; i++) {
    tanks.push(new Tank(Math.random() * canvas.width, Math.random() * canvas.height));
  }

  loop();
};
</script>
</body>
</html>
